{ config, lib, pkgs, ... }:

{
  imports = [
    ../.
    ../../../../common/cpu/amd
    ../../../../common/gpu/amd
  ];

  boot.kernelParams = [
    # With BIOS version 1.12 and the IOMMU enabled, the amdgpu driver
    # either crashes or is not able to attach to the GPU depending on
    # the kernel version. I've seen no issues with the IOMMU disabled.
    #
    # BIOS version 1.13 fixes the IOMMU issues, but we leave the IOMMU
    # in software mode to avoid a sad experience for those people that drew
    # the short straw when they bought their laptop.
    "iommu=soft"
  ];
}
